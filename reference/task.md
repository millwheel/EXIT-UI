# 계정 관리 페이지 추가 요구사항

### 계정 관리 페이지
- 오른쪽 상단에 "등록" 버튼 배치 (계정 추가 버튼)
  - 광고주는 그 누구도 추가할 수 없으므로 등록 버튼 자체가 보이면 안 된다.
- 계정 목록의 각 사용자마다 오른쪽 끝에 톱니바퀴 버튼 배치 (계정 수정 버튼)
  - 광고주는 그 누구도 수정할 수 없으므로 버튼 자체가 보이면 안 된다.
- 총판 마다 오른쪽 끝에 톱니바퀴 버튼 배치 (계정 수정버튼)

### 계정 추가
- 등록 버튼 누르면 계정 추가 모달이 뜬다.
- 등록 모달은 AccountCreateModal 재활용 
- 총판은 총판, 대행사, 광고주를 추가할 수 있다.
- 대행사는 본인 조직에 광고주만 추가할 수 있다.
- 광고주는 계정 추가 할 수 없다.

### 계정 수정
- 톱니바퀴 누르면 계정 수정 모달이 뜬다.
- 수정 모달은 AccountDetailModal 재활용
- 총판은 총판, 대행사, 광고주를 수정할 수 있다.
- 대행사는 본인 조직에 광고주만 수정할 수 있다.
- 광고주는 그 누구도 수정 할 수 없다.

### 계정 삭제
- 계정 수정 모달 하단에 삭제 버튼만 추가한다.
- 삭제 버튼을 누르면 "정말 삭제하시겠습니까? 사용자와 연결된 모든 광고가 제거됩니다." 경고 모달이 그 상위에 한 번 더 뜬다.
- 확인 버튼을 누르면 계정이 삭제된다.
- 총판을 삭제의 경우
  - 해당 총판 하위에 Organization이 존재하면 삭제 불가능 처리. 
    - 경고 모달에서 "관리하고 있는 조직이 있는 총판은 삭제할 수 없습니다." 라고 표시. 확인 버튼만 존재.
  - 해당 총판 하위에 Oragnization이 존재하지 않으면 경고 모달 없이 바로 삭제 처리

### 계정 삭제 파생효과
- 광고주를 삭제하려할 경우 해당 광고에 연결된 advertiserId로 된 모든 Ad 를 삭제하고, 광고주를 삭제한다.
- 대행사를 삭제하려할 경우 해당 대행사에 연결된 조직을 확인하고, 조직에 남아있는 남은 대행사 개수를 파악
  - 더 이상 남아있는 대행사 계정이 없게 된다면 조직을 삭제하고 그 조직에 연결된 모든 Ad를 삭제하고, 광고주를 삭제한다.
  - 만약 해당 조직에 남아있을 대행사 계정이 최소 1개 이상 존재한다면, 조직과 광고 정보는 건들지 않고, 해당 대행사만 삭제한다.

### 추가 수정할 요소
- cell에서 조직 개수와 대행사 개수, 광고주 개수를 보여주는 부분을 수정한다.
- 총판 접속 경우 <div className="text-xs text-gray-400 mt-0.5 font-normal">조직 1</div> 가 아니라 그 총판 사용자가 관리하고 있는 조직 개수를 보여준다.
- 대행사 접속 경우 총판의 조직은 <div className="text-xs text-gray-400 mt-0.5 font-normal">조직 </div> 은 보여지지 않게 한다.
- 광고주 접속의 경우 <div className="text-xs text-gray-400 mt-0.5 font-normal">조직 </div> 과 {data.organization.agencies.length} · 광고주 {data.organization.advertisers.length} 둘다 안보이게 처리한다.

---

## 구현 태스크

### Task 1: UI 버튼 배치
- [x] 1-1. 계정 관리 페이지 오른쪽 상단에 "등록" 버튼 추가
  - 광고주 역할인 경우 버튼 숨김
- [x] 1-2. 계정 목록 테이블에 "관리" 컬럼 추가 (톱니바퀴 버튼)
  - 광고주 역할인 경우 버튼 숨김
- [x] 1-3. 총판 목록 각 셀에 톱니바퀴 버튼 추가 (MASTER 전용)

### Task 2: 계정 추가 기능
- [x] 2-1. AccountCreateModal 확인 및 수정
  - 총판: 역할 선택 (총판/대행사/광고주), 조직 선택 가능
  - 대행사: 역할 고정 (광고주), 조직 고정 (본인 조직)
- [x] 2-2. "등록" 버튼 클릭 시 AccountCreateModal 열기 연결

### Task 3: 계정 수정 기능
- [x] 3-1. AccountEditModal 수정 가능한 형태로 구현
  - 닉네임, 메모 수정 가능
  - 비밀번호 변경 옵션 추가
- [x] 3-2. 톱니바퀴 버튼 클릭 시 AccountEditModal 열기 연결
- [x] 3-3. API PUT /api/accounts/[id] 수정 기능 구현

### Task 4: 계정 삭제 기능
- [x] 4-1. AccountEditModal 하단에 "삭제" 버튼 추가
- [x] 4-2. 삭제 확인 경고 모달 구현 (역할별 분기)
  - 총판 삭제 (하위 조직 존재): "관리하고 있는 조직이 있는 총판은 삭제할 수 없습니다." + 확인 버튼만
  - 총판 삭제 (하위 조직 없음): 경고 모달 없이 바로 삭제
  - 대행사/광고주 삭제: "정말 삭제하시겠습니까? 사용자와 연결된 모든 광고가 제거됩니다." + 확인/취소 버튼
- [x] 4-3. API DELETE /api/accounts/[id] 삭제 로직 구현
  - 총판 삭제: 하위 Organization 존재 여부 확인
    - 존재 → 삭제 불가 (409 반환)
    - 미존재 → 바로 삭제
  - 광고주 삭제: 연결된 Ad 모두 삭제 후 사용자 삭제
  - 대행사 삭제: 조직 내 남은 대행사 확인
    - 남은 대행사 0명 → 조직, Ad, 광고주 모두 삭제
    - 남은 대행사 1명 이상 → 해당 대행사만 삭제

### Task 5: 역할별 조직/계정 개수 표시 수정
- [x] 5-1. MASTER 접속: 총판 셀에 해당 총판이 관리하는 조직 개수 표시
- [x] 5-2. AGENCY 접속: 총판 셀에서 "조직 N" 텍스트 숨김
- [x] 5-3. ADVERTISER 접속: 총판 셀 "조직 N" 숨김, 조직 셀 "대행사 N · 광고주 N" 숨김

### Task 6: 권한 검증
- [x] 6-1. 프론트엔드에서 역할별 버튼 표시/숨김 처리
- [x] 6-2. 백엔드 API에서 역할별 권한 검증 추가
  - 광고주는 생성/수정/삭제 API 호출 시 403 반환